<!--*INDEXED*-->
<html>
<head>
    <!-- meta things -->
    <meta name=viewport content="width=device-width, initial-scale=1">
    <title>Note - Nathan Higley</title>
    <link rel="canonical" href="https://nathanhigley.com" />
    <!-- end meta things -->
  
    <!-- favicon code -->
    <link rel="apple-touch-icon" sizes="180x180" href="../../images/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../images/favicon-16x16.png">
    <link rel="manifest" href="../../images/site.webmanifest">
    <link rel="shortcut icon" href="../../images/favicon.ico">
    <meta name="msapplication-TileColor" content="#2b5797">
    <meta name="msapplication-config" content="../../images/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <!-- end favicon code -->
  
    <!-- style sheets -->
    <link rel="stylesheet" href="../../style-sheets/styles.css">
    <link rel="stylesheet" href="../../style-sheets/bootstrap-grid.css">
    <link rel="stylesheet" href="../../style-sheets/bootstrap-grid.min.css">
    <link rel="stylesheet" href="../../style-sheets/bootstrap-reboot.css">
    <link rel="stylesheet" href="../../style-sheets/bootstrap-reboot.min.css">
    <link rel="stylesheet" href="../../style-sheets/fontawesome.css">
    <link rel="stylesheet" href="../../style-sheets/fonts.css">
    <!-- end style sheets -->
    <link rel="stylesheet" href="css/boostnote.css">
    <link rel="stylesheet" href="css/dracula.css">
    <link rel="stylesheet" href="css/katex.min.css">
    <link rel="stylesheet" href="css/codemirror.css">
    <link rel="stylesheet" href="css/main.min.css">
</head>
<body class="note-body">

    <!-- nav code -->
    <nav>
        <ul class="note-header"> 
            <li class="nav"><a class="nav" href="../../index.html#home"><i class="fas fa-igloo"></i><span class="labels"> Home</span></a></li>
            <li class="nav"><a class="nav" href="../../index.html#about"><i class="fas fa-info-circle"></i><span class="labels"> About</span></a></li>
            <li class="nav"><a class="nav" href="../../index.html#work"><i class="fas fa-desktop"></i><span class="labels"> Work</span></a></li>
            <li class="nav"><a class="nav" href="../../index.html#contact"><i class="fas fa-address-card"></i><span class="labels"> Contact</span></a></li>
            <li class="nav"><a class="nav" href="../notes.html"><i class="fas fa-sticky-note"></i><span class="labels"> Notes</span></a></li>
        </ul>
    </nav>
    <!-- end nav code -->
    <div class="d-flex" >
      <div class="container-fluid">
        <div class="row">
          <div class="col-lg-12 note-spacer"></div>
          <div class="col-lg-12"><h1 id="Configuring-SSF-for-Port-Forwarding" data-line="0">Configuring SSF for Port Forwarding</h1><p data-line="3">To configure SSF you have to do different things on the server with the public facing IP and on the client which runs the service you want to forward.</p>
<h3 id="Install-SSF" data-line="5">Install SSF</h3>
<h4 id="Do-on-both-Server-and-Client" data-line="7">Do on both Server and Client</h4>
<p data-line="8">Download SSF: <a href="https://securesocketfunneling.github.io/ssf/#security-features">SSF - Secure Socket Funneling - Network tool - TCP and UDP port forwarding, SOCKS proxy, Remote shell, Native Relay protocol, Standalone</a></p>
<p data-line="10">Extract to /opt/ssf</p>
<blockquote data-line="12">
<p data-line="12"># unzip *.zip /opt/ssf</p>
</blockquote>
<h3 id="Setup-keys" data-line="14">Setup keys</h3>
<blockquote data-line="15">
<p data-line="15"><a href="https://securesocketfunneling.github.io/ssf/#security-features">SSF - Secure Socket Funneling - Network tool - TCP and UDP port forwarding, SOCKS proxy, Remote shell, Native Relay protocol, Standalone</a></p>
</blockquote>
<h4 id="Do-on-both-the-Server-and-Client" data-line="18">Do on both the Server and Client</h4>
<p data-line="19">Generate Diffie-Hellman parameters</p>
<blockquote data-line="20">
<p data-line="20"># openssl dhparam 4096 -outform PEM -out dh4096.pem</p>
</blockquote>
<h4 id="Do-on-the-Client" data-line="21">Do on the Client</h4>
<p data-line="22">Generate a Certificate Authority</p>
<blockquote data-line="23">
<p data-line="23"># openssl req -x509 -nodes -newkey rsa:4096 -keyout ca.key -out ca.crt -days 3650</p>
</blockquote>
<h4 id="Copy-to-Server" data-line="24">Copy to Server</h4>
<blockquote data-line="25">
<p data-line="25"># scp  /opt/ssf/certs/ca.*  user@&lt;server-ip&gt;:/opt/ssf/certs/</p>
</blockquote>
<h4 id="Do-on-both-the-Server-and-Client-1" data-line="26">Do on both the Server and Client</h4>
<p data-line="27">Create ‘extfile.txt’:</p>
<blockquote data-line="28">
<p data-line="28"># touch extfile.txt</p>
</blockquote>
<pre class="code CodeMirror cm-s-dracula" data-line="29">        <span class="filename"></span>
        <span class="lineNumber CodeMirror-gutters"><span class="CodeMirror-linenumber">1</span><span class="CodeMirror-linenumber">2</span><span class="CodeMirror-linenumber">3</span><span class="CodeMirror-linenumber">4</span><span class="CodeMirror-linenumber">5</span><span class="CodeMirror-linenumber">6</span><span class="CodeMirror-linenumber">7</span></span>
        <code class="">[ v3_req_p ]
basicConstraints = CA:FALSE
keyUsage = nonRepudiation, digitalSignature, keyEncipherment

[ v3_ca_p ]
basicConstraints = CA:TRUE
keyUsage = nonRepudiation, digitalSignature, keyEncipherment, keyCertSign
</code>
      <i><button class="clipboardButton"><svg width="13" height="13" viewBox="0 0 1792 1792"><path d="M768 1664h896v-640h-416q-40 0-68-28t-28-68v-416h-384v1152zm256-1440v-64q0-13-9.5-22.5t-22.5-9.5h-704q-13 0-22.5 9.5t-9.5 22.5v64q0 13 9.5 22.5t22.5 9.5h704q13 0 22.5-9.5t9.5-22.5zm256 672h299l-299-299v299zm512 128v672q0 40-28 68t-68 28h-960q-40 0-68-28t-28-68v-160h-544q-40 0-68-28t-28-68v-1344q0-40 28-68t68-28h1088q40 0 68 28t28 68v328q21 13 36 28l408 408q28 28 48 76t20 88z"></path></svg></button></i></pre><p data-line="39">Generate private key and certificate (leave fields blank):</p>
<blockquote data-line="40">
<p data-line="40"># openssl req -newkey rsa:4096 -nodes -keyout private.key -out certificate.csr<br>
# openssl x509 -extfile extfile.txt -extensions v3_req_p -req -sha1 -days 3650 -CA ca.crt -CAkey ca.key -CAcreateserial -in certificate.csr -out certificate.crt<br>
# cat ca.crt &gt;&gt; certificate.crt</p>
</blockquote>
<p data-line="44">Encrypt private key with password:</p>
<blockquote data-line="45">
<p data-line="45"># openssl rsa -in private.key -out private.key -aes256 -passout pass:&lt;password&gt;</p>
</blockquote>
<p data-line="47">Move ca.crt to Trusted Folder:</p>
<blockquote data-line="48">
<p data-line="48"># mv /opt/ssf/certs/ca.crt /opt/ssf/certs/trusted/ca.crt</p>
</blockquote>
<h3 id="Create-Configuration-File-for-SSF" data-line="50">Create Configuration File for SSF</h3>
<h4 id="On-Server" data-line="52">On Server</h4>
<blockquote data-line="54">
<p data-line="54"># touch /opt/ssf/ssf.conf</p>
</blockquote>
<pre class="code CodeMirror cm-s-dracula" data-line="56">        <span class="filename"></span>
        <span class="lineNumber CodeMirror-gutters"><span class="CodeMirror-linenumber">1</span><span class="CodeMirror-linenumber">2</span><span class="CodeMirror-linenumber">3</span><span class="CodeMirror-linenumber">4</span><span class="CodeMirror-linenumber">5</span><span class="CodeMirror-linenumber">6</span><span class="CodeMirror-linenumber">7</span><span class="CodeMirror-linenumber">8</span><span class="CodeMirror-linenumber">9</span><span class="CodeMirror-linenumber">10</span><span class="CodeMirror-linenumber">11</span><span class="CodeMirror-linenumber">12</span><span class="CodeMirror-linenumber">13</span><span class="CodeMirror-linenumber">14</span><span class="CodeMirror-linenumber">15</span><span class="CodeMirror-linenumber">16</span><span class="CodeMirror-linenumber">17</span><span class="CodeMirror-linenumber">18</span><span class="CodeMirror-linenumber">19</span><span class="CodeMirror-linenumber">20</span><span class="CodeMirror-linenumber">21</span><span class="CodeMirror-linenumber">22</span><span class="CodeMirror-linenumber">23</span><span class="CodeMirror-linenumber">24</span><span class="CodeMirror-linenumber">25</span><span class="CodeMirror-linenumber">26</span><span class="CodeMirror-linenumber">27</span><span class="CodeMirror-linenumber">28</span><span class="CodeMirror-linenumber">29</span><span class="CodeMirror-linenumber">30</span><span class="CodeMirror-linenumber">31</span><span class="CodeMirror-linenumber">32</span><span class="CodeMirror-linenumber">33</span><span class="CodeMirror-linenumber">34</span><span class="CodeMirror-linenumber">35</span><span class="CodeMirror-linenumber">36</span><span class="CodeMirror-linenumber">37</span><span class="CodeMirror-linenumber">38</span><span class="CodeMirror-linenumber">39</span><span class="CodeMirror-linenumber">40</span><span class="CodeMirror-linenumber">41</span><span class="CodeMirror-linenumber">42</span><span class="CodeMirror-linenumber">43</span><span class="CodeMirror-linenumber">44</span><span class="CodeMirror-linenumber">45</span><span class="CodeMirror-linenumber">46</span></span>
        <code class="">{
  "ssf": {
    "arguments": "",
    "circuit": [],
    "tls" : {
      "ca_cert_path": "/opt/ssf/certs/trusted/ca.crt",
      "cert_path": "/opt/ssf/certs/certificate.crt",
      "key_path": "/opt/ssf/certs/private.key",
      "key_password": "&lt;server-private-key-password&gt;",
      "dh_path": "/opt/ssf/certs/dh4096.pem",
      "cipher_alg": "DHE-RSA-AES256-GCM-SHA384"
    },
    "http_proxy" : {
      "host": "",
      "port": "",
      "user_agent": "",
      "credentials": {
        "username": "",
        "password": "",
        "domain": "",
        "reuse_ntlm": "true",
        "reuse_nego": "true"
      }
    },
    "services": {
      "datagram_forwarder": { "enable": false },
      "datagram_listener": {
        "enable": false,
        "gateway_ports": false
      },
      "stream_forwarder": { "enable": false },
      "stream_listener": {
        "enable": true,
        "gateway_ports": true
      },
      "copy": { "enable": false },
      "shell": {
        "enable": false,
        "path": "/bin/bash|C:\\windows\\system32\\cmd.exe",
        "args": ""
      },
      "socks": { "enable": false }
    }
  }
}

</code>
      <i><button class="clipboardButton"><svg width="13" height="13" viewBox="0 0 1792 1792"><path d="M768 1664h896v-640h-416q-40 0-68-28t-28-68v-416h-384v1152zm256-1440v-64q0-13-9.5-22.5t-22.5-9.5h-704q-13 0-22.5 9.5t-9.5 22.5v64q0 13 9.5 22.5t22.5 9.5h704q13 0 22.5-9.5t9.5-22.5zm256 672h299l-299-299v299zm512 128v672q0 40-28 68t-68 28h-960q-40 0-68-28t-28-68v-160h-544q-40 0-68-28t-28-68v-1344q0-40 28-68t68-28h1088q40 0 68 28t28 68v328q21 13 36 28l408 408q28 28 48 76t20 88z"></path></svg></button></i></pre><h4 id="On-Client" data-line="105">On Client</h4>
<blockquote data-line="107">
<p data-line="107"># touch /opt/ssf/ssf.conf</p>
</blockquote>
<pre class="code CodeMirror cm-s-dracula" data-line="109">        <span class="filename"></span>
        <span class="lineNumber CodeMirror-gutters"><span class="CodeMirror-linenumber">1</span><span class="CodeMirror-linenumber">2</span><span class="CodeMirror-linenumber">3</span><span class="CodeMirror-linenumber">4</span><span class="CodeMirror-linenumber">5</span><span class="CodeMirror-linenumber">6</span><span class="CodeMirror-linenumber">7</span><span class="CodeMirror-linenumber">8</span><span class="CodeMirror-linenumber">9</span><span class="CodeMirror-linenumber">10</span><span class="CodeMirror-linenumber">11</span><span class="CodeMirror-linenumber">12</span><span class="CodeMirror-linenumber">13</span><span class="CodeMirror-linenumber">14</span><span class="CodeMirror-linenumber">15</span><span class="CodeMirror-linenumber">16</span><span class="CodeMirror-linenumber">17</span><span class="CodeMirror-linenumber">18</span><span class="CodeMirror-linenumber">19</span><span class="CodeMirror-linenumber">20</span><span class="CodeMirror-linenumber">21</span><span class="CodeMirror-linenumber">22</span><span class="CodeMirror-linenumber">23</span><span class="CodeMirror-linenumber">24</span><span class="CodeMirror-linenumber">25</span><span class="CodeMirror-linenumber">26</span><span class="CodeMirror-linenumber">27</span><span class="CodeMirror-linenumber">28</span><span class="CodeMirror-linenumber">29</span><span class="CodeMirror-linenumber">30</span><span class="CodeMirror-linenumber">31</span><span class="CodeMirror-linenumber">32</span><span class="CodeMirror-linenumber">33</span><span class="CodeMirror-linenumber">34</span><span class="CodeMirror-linenumber">35</span><span class="CodeMirror-linenumber">36</span><span class="CodeMirror-linenumber">37</span><span class="CodeMirror-linenumber">38</span><span class="CodeMirror-linenumber">39</span><span class="CodeMirror-linenumber">40</span><span class="CodeMirror-linenumber">41</span><span class="CodeMirror-linenumber">42</span><span class="CodeMirror-linenumber">43</span><span class="CodeMirror-linenumber">44</span><span class="CodeMirror-linenumber">45</span><span class="CodeMirror-linenumber">46</span></span>
        <code class="">{
  "ssf": {
    "arguments": "",
    "circuit": [],
    "tls" : {
      "ca_cert_path": "/opt/ssf/certs/trusted/ca.crt",
      "cert_path": "/opt/ssf/certs/certificate.crt",
      "key_path": "/opt/ssf/certs/private.key",
      "key_password": "&lt;client-private-key-password&gt;",
      "dh_path": "/opt/ssf/certs/dh4096.pem",
      "cipher_alg": "DHE-RSA-AES256-GCM-SHA384"
    },
    "http_proxy" : {
      "host": "",
      "port": "",
      "user_agent": "",
      "credentials": {
        "username": "",
        "password": "",
        "domain": "",
        "reuse_ntlm": "true",
        "reuse_nego": "true"
      }
    },
    "services": {
      "datagram_forwarder": { "enable": false },
      "datagram_listener": {
        "enable": false,
        "gateway_ports": false
      },
      "stream_forwarder": { "enable": true },
      "stream_listener": {
        "enable": false,
        "gateway_ports": true
      },
      "copy": { "enable": false },
      "shell": {
        "enable": false,
        "path": "/bin/bash|C:\\windows\\system32\\cmd.exe",
        "args": ""
      },
      "socks": { "enable": false }
    }
  }
}

</code>
      <i><button class="clipboardButton"><svg width="13" height="13" viewBox="0 0 1792 1792"><path d="M768 1664h896v-640h-416q-40 0-68-28t-28-68v-416h-384v1152zm256-1440v-64q0-13-9.5-22.5t-22.5-9.5h-704q-13 0-22.5 9.5t-9.5 22.5v64q0 13 9.5 22.5t22.5 9.5h704q13 0 22.5-9.5t9.5-22.5zm256 672h299l-299-299v299zm512 128v672q0 40-28 68t-68 28h-960q-40 0-68-28t-28-68v-160h-544q-40 0-68-28t-28-68v-1344q0-40 28-68t68-28h1088q40 0 68 28t28 68v328q21 13 36 28l408 408q28 28 48 76t20 88z"></path></svg></button></i></pre><h3 id="Configure-Systemd-Services" data-line="158">Configure Systemd Services</h3>
<blockquote data-line="160">
<p data-line="160"># /etc/systemd/system/ssf-server.service</p>
</blockquote>
<pre class="code CodeMirror cm-s-dracula" data-line="161">        <span class="filename"></span>
        <span class="lineNumber CodeMirror-gutters"><span class="CodeMirror-linenumber">1</span><span class="CodeMirror-linenumber">2</span><span class="CodeMirror-linenumber">3</span><span class="CodeMirror-linenumber">4</span><span class="CodeMirror-linenumber">5</span><span class="CodeMirror-linenumber">6</span><span class="CodeMirror-linenumber">7</span><span class="CodeMirror-linenumber">8</span><span class="CodeMirror-linenumber">9</span><span class="CodeMirror-linenumber">10</span><span class="CodeMirror-linenumber">11</span></span>
        <code class="">[Unit]
Description=SSF Server Service
After=network.target

[Service]
User=root
ExecStart=/opt/ssf/ssfd -p &lt;port-to-host-ssf-on&gt; -c /opt/ssf/ssf.conf -g

[Install]
WantedBy=multi-user.target

</code>
      <i><button class="clipboardButton"><svg width="13" height="13" viewBox="0 0 1792 1792"><path d="M768 1664h896v-640h-416q-40 0-68-28t-28-68v-416h-384v1152zm256-1440v-64q0-13-9.5-22.5t-22.5-9.5h-704q-13 0-22.5 9.5t-9.5 22.5v64q0 13 9.5 22.5t22.5 9.5h704q13 0 22.5-9.5t9.5-22.5zm256 672h299l-299-299v299zm512 128v672q0 40-28 68t-68 28h-960q-40 0-68-28t-28-68v-160h-544q-40 0-68-28t-28-68v-1344q0-40 28-68t68-28h1088q40 0 68 28t28 68v328q21 13 36 28l408 408q28 28 48 76t20 88z"></path></svg></button></i></pre><blockquote data-line="175">
<p data-line="175"># /etc/systemd/system/ssf-client.service</p>
</blockquote>
<pre class="code CodeMirror cm-s-dracula" data-line="176">        <span class="filename"></span>
        <span class="lineNumber CodeMirror-gutters"><span class="CodeMirror-linenumber">1</span><span class="CodeMirror-linenumber">2</span><span class="CodeMirror-linenumber">3</span><span class="CodeMirror-linenumber">4</span><span class="CodeMirror-linenumber">5</span><span class="CodeMirror-linenumber">6</span><span class="CodeMirror-linenumber">7</span><span class="CodeMirror-linenumber">8</span><span class="CodeMirror-linenumber">9</span><span class="CodeMirror-linenumber">10</span></span>
        <code class="">[Unit]
Description=SSF Client Service
After=network.target

[Service]
User=root
ExecStart=/opt/ssf/ssf -R 0.0.0.0:&lt;port-to-forward&gt;:127.0.0.1:&lt;port-to-forward&gt; -p &lt;port-to-host-ssf-on&gt; &lt;server-public-ip&gt; -c /opt/ssf/ssf.conf -g

[Install]
WantedBy=multi-user.target
</code>
      <i><button class="clipboardButton"><svg width="13" height="13" viewBox="0 0 1792 1792"><path d="M768 1664h896v-640h-416q-40 0-68-28t-28-68v-416h-384v1152zm256-1440v-64q0-13-9.5-22.5t-22.5-9.5h-704q-13 0-22.5 9.5t-9.5 22.5v64q0 13 9.5 22.5t22.5 9.5h704q13 0 22.5-9.5t9.5-22.5zm256 672h299l-299-299v299zm512 128v672q0 40-28 68t-68 28h-960q-40 0-68-28t-28-68v-160h-544q-40 0-68-28t-28-68v-1344q0-40 28-68t68-28h1088q40 0 68 28t28 68v328q21 13 36 28l408 408q28 28 48 76t20 88z"></path></svg></button></i></pre><h3 id="Enable-Services-and-Start-Them" data-line="189">Enable Services and Start Them</h3>
<h4 id="On-Server-1" data-line="191">On Server</h4>
<blockquote data-line="193">
<p data-line="193"># systemctl enable ssf-server.service<br>
# service ssf-server start</p>
</blockquote>
<h4 id="On-Server-2" data-line="196">On Server</h4>
<blockquote data-line="198">
<p data-line="198"># systemctl enable ssf-client.service<br>
# service ssf-client start</p>
</blockquote>
</div></div></div></div>
<!--footer code-->
<footer>
    <a class=footer-link target="_blank" rel="noopener noreferrer" href="https://github.com/nadehi18"><i class="fab fa-github"></i></a>
    <a class=footer-link target="_blank" rel="noopener noreferrer" href="https://linkedin.com/in/nadehi18"><i class="fab fa-linkedin"></i></a>
    <a class=footer-link target="_blank" rel="noopener noreferrer" href="https://twitter.com/nadehi18"><i class="fab fa-twitter"></i></a>
</footer>
<!-- end footer code-->
</body>